'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var reactDom = require('react-dom');
var ScrollLock = require('react-scrolllock');
var FocusTrap = require('focus-trap-react');
var modalUtils = require('@arch-ui/modal-utils');
var typography = require('@arch-ui/typography');
var _extends = require('@babel/runtime/helpers/extends');
var _objectWithoutProperties = require('@babel/runtime/helpers/objectWithoutProperties');
var core = require('@emotion/core');
var styled = require('@emotion/styled');
var theme = require('@arch-ui/theme');
var colorUtils = require('@arch-ui/color-utils');

function _interopDefault (e) { return e && e.__esModule ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefault(React);
var ScrollLock__default = /*#__PURE__*/_interopDefault(ScrollLock);
var FocusTrap__default = /*#__PURE__*/_interopDefault(FocusTrap);
var _extends__default = /*#__PURE__*/_interopDefault(_extends);
var _objectWithoutProperties__default = /*#__PURE__*/_interopDefault(_objectWithoutProperties);
var styled__default = /*#__PURE__*/_interopDefault(styled);

const outerGutter = 40;
const innerGutter = 20;
const Positioner = styled__default['default'].div(({
  width
}) => ({
  display: 'flex',
  flexDirection: 'column',
  left: 0,
  marginLeft: 'auto',
  marginRight: 'auto',
  maxHeight: `calc(100% - ${outerGutter * 2}px)`,
  maxWidth: width,
  position: 'fixed',
  right: 0,
  top: outerGutter,
  zIndex: 2
}));
const Dialog = /*#__PURE__*/React.forwardRef((_ref, ref) => {
  let {
    component: Tag
  } = _ref,
      props = _objectWithoutProperties__default['default'](_ref, ["component"]);

  return core.jsx(Tag, _extends__default['default']({
    ref: ref,
    role: "dialog",
    css: {
      backgroundColor: 'white',
      borderRadius: 5,
      boxShadow: '0 2px 8px -1px rgba(0,0,0,0.3)',
      display: 'flex',
      flex: 1,
      flexDirection: 'column',
      maxHeight: '100%'
    }
  }, props));
});
const HeadFoot = styled__default['default'].div({
  lineHeight: 1,
  margin: `0 ${innerGutter}px`,
  paddingBottom: innerGutter,
  paddingTop: innerGutter,
  // ensure that box-shadow covers body content
  position: 'relative',
  zIndex: 1
});
const Header = styled__default['default'](HeadFoot)({
  boxShadow: `0 2px 0 ${colorUtils.alpha(theme.colors.text, 0.12)}`
});
const Footer = styled__default['default'](HeadFoot)({
  boxShadow: `0 -2px 0 ${colorUtils.alpha(theme.colors.text, 0.12)}`
});
const Title = styled__default['default'].h3({
  fontSize: 18,
  fontWeight: 500,
  margin: 0
});
const Body = styled__default['default'].div({
  lineHeight: 1.4,
  overflowY: 'auto',
  padding: innerGutter
});

const ModalDialog = /*#__PURE__*/React.memo(({
  attachTo = typeof document !== 'undefined' ? document.body : null,
  children,
  closeOnBlanketClick = false,
  component = 'div',
  footer,
  heading,
  initialFocus,
  onClose,
  onKeyDown,
  transitionState,
  width = 640
}) => {
  React.useEffect(() => {
    const handleKeyDown = e => {
      if (onKeyDown) onKeyDown(e);
    };

    document.addEventListener('keydown', handleKeyDown, false);
    return () => {
      document.removeEventListener('keydown', handleKeyDown, false);
    };
  });
  const dialogTitleId = modalUtils.generateUEID();

  if (!attachTo) {
    return null;
  }

  return /*#__PURE__*/reactDom.createPortal( /*#__PURE__*/React__default['default'].createElement(React.Fragment, null, /*#__PURE__*/React__default['default'].createElement(modalUtils.Blanket, {
    style: modalUtils.fade(transitionState),
    onClick: closeOnBlanketClick ? onClose : undefined,
    isTinted: true
  }), /*#__PURE__*/React__default['default'].createElement(Positioner, {
    style: modalUtils.slideUp(transitionState),
    width: width
  }, /*#__PURE__*/React__default['default'].createElement(FocusTrap__default['default'], {
    focusTrapOptions: {
      initialFocus,
      clickOutsideDeactivates: closeOnBlanketClick
    }
  }, /*#__PURE__*/React__default['default'].createElement(Dialog, {
    component: component,
    "aria-labelledby": dialogTitleId
  }, /*#__PURE__*/React__default['default'].createElement(typography.A11yText, {
    id: dialogTitleId
  }, heading, " Dialog"), heading ? /*#__PURE__*/React__default['default'].createElement(Header, null, /*#__PURE__*/React__default['default'].createElement(Title, null, heading)) : null, /*#__PURE__*/React__default['default'].createElement(ScrollLock__default['default'], null, /*#__PURE__*/React__default['default'].createElement(Body, null, children)), footer ? /*#__PURE__*/React__default['default'].createElement(Footer, null, footer) : null)))), attachTo);
});
var Dialog$1 = modalUtils.withTransitionState(ModalDialog);

exports.default = Dialog$1;
